<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Python extension for libmemcache</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@python.org
:Date: $Date$
:Revision: $Revision$
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="python-extension-for-libmemcache">
<h1 class="title">Python extension for libmemcache</h1>

<!-- -*- mode: text -*- -->
<!-- $Id$ -->
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#description" id="id3" name="id3">Description</a></li>
<li><a class="reference" href="#motivation" id="id4" name="id4">Motivation</a></li>
<li><a class="reference" href="#dependencies" id="id5" name="id5">Dependencies</a></li>
<li><a class="reference" href="#download" id="id6" name="id6">Download</a></li>
<li><a class="reference" href="#to-do" id="id7" name="id7">To do</a></li>
<li><a class="reference" href="#known-bugs" id="id8" name="id8">Known Bugs</a></li>
<li><a class="reference" href="#changes" id="id9" name="id9">Changes</a></li>
<li><a class="reference" href="#copyright-and-license" id="id10" name="id10">Copyright and License</a></li>
<li><a class="reference" href="#author" id="id11" name="id11">Author</a></li>
</ul>
</div>
<!-- 1  Description
2  Motivation
3  Dependencies
4  Download
5  To do
6  Known Bugs
7  Copyright and License
8  Author -->
<div class="section">
<h1><a class="toc-backref" href="#id3" id="description" name="description">Description</a></h1>
<p>Python extension for <a class="reference" href="http://people.freebsd.org/~seanc/libmemcache">libmemcache</a>, the C
API to <a class="reference" href="http://www.danga.com/memcached/">memcached</a>. cmemcache API is very similar to
<a class="reference" href="ftp://ftp.tummy.com/pub/python-memcached/">python-memcache</a>, except for some return
codes which follow libmemcache conventions.</p>
<p>cmemcache is about 2 times faster then python-memcache with short key names (8
characters), faster with larger key names.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id4" id="motivation" name="motivation">Motivation</a></h1>
<p>This extension was created after doing some timings on a simple session caching scheme
where I noticed that python-memcache was 'only' three times as fast as PostgreSQL. I
expected it to be faster than that, since PostgreSQL does a lot more than memcached. It
was suggested that it was perhaps python-memcache, which for instance gets the initial
part of the message from memcached byte for byte. After discovering libmemcache it seemed
pretty straight forward to create an extension on top of that.</p>
<p>cmemcache has 2 clients: StringClient and Client. StringClient is the extension that only
supports python strings for values. The api was copied from python-memcache, except that
it excepts strings only. Client is a module that implements caching of arbitrary python
objects using Pickle on top of the StringClient. This code is a copy/paste from
python-memcache. Most of the test code in <a class="reference" href="test.py">test.py</a> is run on the cmemcache
Client and the python-memcache Client to make sure that they are interchangeable. Although
I have not tested this but it should be possible to mix cmemcache and python-memcache
clients in a running system as well, since they use the same constants for encoding object
types.</p>
<p>The speed difference would be less if the memcached protocol would be changed to precede
the reply header with its size. A client could then read the header size, read the full
header (in one read), parse header to get the data size, and read data (this is already
done in one read).</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id5" id="dependencies" name="dependencies">Dependencies</a></h1>
<ul class="simple">
<li>Python</li>
<li><a class="reference" href="http://people.freebsd.org/~seanc/libmemcache">libmemcache</a> (using version 1.4.0.rc2,
not sure which is required)</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id6" id="download" name="download">Download</a></h1>
<ul class="simple">
<li><a class="reference" href="/downloads/cmemcache/">Download</a></li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id7" id="to-do" name="to-do">To do</a></h1>
<ul class="simple">
<li>use mc_req_add_ref to avoid copy of key</li>
<li>add performance test to test.py</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id8" id="known-bugs" name="known-bugs">Known Bugs</a></h1>
<ul class="simple">
<li>set_servers with the wrong port number causes a segfault (in libmemcache). See commented
out testing code in test.py.</li>
<li>mc_err_filter_add() broken, I have a fix for this, but I have not send a patch to
libmemcache maintainers. This (can) results in warnings on add() and replace().</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id9" id="changes" name="changes">Changes</a></h1>
<p>Versions:</p>
<dl class="docutils">
<dt>0.91</dt>
<dd>Remove <tt class="docutils literal"><span class="pre">&#64;staticmethod</span></tt> from <tt class="docutils literal"><span class="pre">_convert</span></tt> method to make it python 2.3 compatible.</dd>
<dt>0.90</dt>
<dd>Initial version.</dd>
</dl>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id10" id="copyright-and-license" name="copyright-and-license">Copyright and License</a></h1>
<p>Copyright (C) 2006  Gijsbert de Haan.
This code is distributed under the <a class="reference" href="COPYING">GNU General Public License</a>.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id11" id="author" name="author">Author</a></h1>
<p>Gijsbert de Haan &lt;<a class="reference" href="mailto:gijsbert.de.haan&#64;gmail.com">gijsbert.de.haan&#64;gmail.com</a>&gt;</p>
</div>
</div>
</body>
</html>
